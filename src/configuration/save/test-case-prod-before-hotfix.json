[
  {
    "no": "2011",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_1"
  },
  {
    "no": "2012",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_2"
  },
  {
    "no": "2013",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_3"
  },
  {
    "no": "2014",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_4"
  },
  {
    "no": "2015",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_5"
  },
  {
    "no": "2016",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_6"
  },
  {
    "no": "2017",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_7"
  },
  {
    "no": "2018",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_8"
  },
  {
    "no": "2019",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q5_9"
  },
  {
    "no": "2020",
    "queryPattern": "Q5",
    "name": "Display Aggregate Json",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100",
    "queryAlias": "Q5_10"
  },
  {
    "no": "2267",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/92aea2c5-9f75-4702-8d32-c9eec0839560/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_1"
  },
  {
    "no": "2268",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/574dda23-7826-4bc1-be81-de6fa2499d64/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_2"
  },
  {
    "no": "2269",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%012206%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7338f39b-9f01-4be2-812f-57c9c23f741b/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_3"
  },
  {
    "no": "2270",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "8/3/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/8168d505-bcff-43c0-b4a9-499963677f81/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_4"
  },
  {
    "no": "2271",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "8/9/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/ced6e63a-761f-4124-9510-63856d3e3442/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_5"
  },
  {
    "no": "2272",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "10/11/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' AND l.couponName LIKE '%京たんごフルーツキャンペーン【サンプル】%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' AND l.couponName LIKE '%京たんごフルーツキャンペーン【サンプル】%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/270f0d99-6110-4db3-8e35-9e3bcc2bbdd6/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_6"
  },
  {
    "no": "2273",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "10/17/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4dd7b332-f729-4624-b16a-02470b37fd13/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_7"
  },
  {
    "no": "2274",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "11/22/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/1da70939-2558-442d-8f00-efbdc60ddda3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_8"
  },
  {
    "no": "2275",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "11/23/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/2f8f19ab-3173-4603-80c0-37fe322d58eb/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_9"
  },
  {
    "no": "2276",
    "queryPattern": "Q6",
    "name": "Display Aggregate Csv",
    "lambda": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "functionName": "displayedCsvSql",
    "isMatching": "1",
    "timestamp": "11/24/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/0b481299-bd99-43ce-ba0c-e9e8a23c5e86/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF",
    "queryAlias": "Q6_10"
  },
  {
    "no": "2615",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 20 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 20 OFFSET 0",
    "queryAlias": "Q7_1"
  },
  {
    "no": "2616",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_2"
  },
  {
    "no": "2617",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100",
    "queryAlias": "Q7_3"
  },
  {
    "no": "2618",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_4"
  },
  {
    "no": "2619",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_5"
  },
  {
    "no": "2620",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_6"
  },
  {
    "no": "2621",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022952007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e20e5fa3-b373-4f1b-b175-4f66fda2be78' AND l.couponCode LIKE '%022952007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_7"
  },
  {
    "no": "2622",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_8"
  },
  {
    "no": "2623",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_9"
  },
  {
    "no": "2624",
    "queryPattern": "Q7",
    "name": "Usage Aggregate Json byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byCouponMasterSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%1010cp-DM-7-23-radio%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%1010cp-DM-7-23-radio%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q7_10"
  },
  {
    "no": "4336",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/4/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_1"
  },
  {
    "no": "4337",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/4/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_2"
  },
  {
    "no": "4345",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/12/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '86b02ca3-a865-40ac-af49-958eb6f2176c' AND o.type = 'SHOP' AND o.name LIKE '%近鉄郡山店%' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '86b02ca3-a865-40ac-af49-958eb6f2176c' AND o.type = 'SHOP' AND o.name LIKE '%近鉄郡山店%' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_3"
  },
  {
    "no": "4347",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_4"
  },
  {
    "no": "4349",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_5"
  },
  {
    "no": "4351",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_6"
  },
  {
    "no": "4352",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100",
    "queryAlias": "Q8_7"
  },
  {
    "no": "4353",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' AND o.name LIKE '%中延店%' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' AND o.name LIKE '%中延店%' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_8"
  },
  {
    "no": "4358",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/21/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_9"
  },
  {
    "no": "4359",
    "queryPattern": "Q8",
    "name": "Usage Aggregate Json byOrganizationSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "functionName": "byOrganizationSql",
    "isMatching": "1",
    "timestamp": "7/24/2023",
    "shortSQL": "_SAME_ WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l WHERE l.organizationId = o.resourceId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0",
    "queryAlias": "Q8_10"
  },
  {
    "no": "5849",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4da9b6c6-0239-4900-a4c1-a9031adda551/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_1"
  },
  {
    "no": "5850",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'be6821fa-6ac1-478c-a356-64d24a317a63' AND l.couponCode LIKE '%022956007%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/09abebbd-c921-4dec-8639-07ecee82f78a/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_2"
  },
  {
    "no": "5851",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/0d0a3e7b-4764-439c-82d4-1789e8c307fc/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_3"
  },
  {
    "no": "5852",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "6/26/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '77d5a94c-249e-4a2e-b7eb-b13bb418733b' AND l.couponName LIKE '%商品A コード入力%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '77d5a94c-249e-4a2e-b7eb-b13bb418733b' AND l.couponName LIKE '%商品A コード入力%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/426d2fc6-26c1-4196-9ab0-48f56af7ca11/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_4"
  },
  {
    "no": "5853",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/3/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6e7a9534-a97a-41aa-a12b-1d2e8593112c/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_5"
  },
  {
    "no": "5855",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/06dc1ad3-a8b2-401d-90b1-9a6845b56379/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_6"
  },
  {
    "no": "5857",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/b74e4a50-6590-4ee9-820c-2c6a647f15ec/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_7"
  },
  {
    "no": "5858",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/21/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6acf6dc1-500c-4ecf-8f84-57b517c5fa22/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_8"
  },
  {
    "no": "5860",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/24/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' AND l.couponCode LIKE '%gogoSINGLE5%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' AND l.couponCode LIKE '%gogoSINGLE5%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/5b425ef0-9af2-4969-a5fe-30da23a25583/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_9"
  },
  {
    "no": "5861",
    "queryPattern": "Q9",
    "name": "Usage Aggregate Csv byCouponMasterSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byCouponMasterCsvSql",
    "isMatching": "1",
    "timestamp": "7/24/2023",
    "shortSQL": "_SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' AND l.couponCode LIKE '%gogoSINGLE4%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type = 'issued' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l3 WHERE l2.couponId = l3.couponId AND l3.type <> 'displayed' AND l2.createAtMillis < l3.createAtMillis ) ) AS \"キャンセル\" FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' AND l.couponCode LIKE '%gogoSINGLE4%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9dc74cde-8e86-4445-a848-c6776bbecf09/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q9_10"
  },
  {
    "no": "6322",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "7/7/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7a5aab76-3331-44c1-806a-ce544da6875d/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_1"
  },
  {
    "no": "6324",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "7/19/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/626d4f4a-9c6e-4a5e-9ecc-af548ec2b6c3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_2"
  },
  {
    "no": "6327",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "7/24/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4daa5fae-e23e-4a2e-ac2f-67e04b1948ba/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_3"
  },
  {
    "no": "6336",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "8/1/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/1aafa6f4-75b4-4d99-8e0d-0e9b5a42be1b/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_4"
  },
  {
    "no": "6385",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/14/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'd4e3ccff-215e-4bf3-b85b-d120b1e75278' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'd4e3ccff-215e-4bf3-b85b-d120b1e75278' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/bb709c96-3939-4cdc-aeb4-50e16efa1f67/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_5"
  },
  {
    "no": "6394",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/27/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9123ee7f-42af-42b3-906e-1ea0ceec0988/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_6"
  },
  {
    "no": "6396",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/27/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/98b8c169-2061-4fa6-8bad-45216501de63/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_7"
  },
  {
    "no": "6397",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/27/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SMALL_SHOP_GROUP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SMALL_SHOP_GROUP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7947a4cf-6d7e-49e3-9703-77d4fe1590fe/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_8"
  },
  {
    "no": "6398",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/27/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/643d1f99-920e-48e5-a9f2-85a29fba48c9/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_9"
  },
  {
    "no": "6400",
    "queryPattern": "Q10",
    "name": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambda": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "functionName": "byOrganizationCsvSql",
    "isMatching": "1",
    "timestamp": "11/27/2023",
    "shortSQL": "_SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs l WHERE o.resourceId = l.organizationId AND type = 'issued' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type = 'issued' AND l.createAtMillis < l2.createAtMillis ) ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'used' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND type = 'canceled' AND NOT EXISTS( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) ) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/c53ac46e-0c4c-4f64-a678-341cad4d5a73/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF",
    "queryAlias": "Q10_10"
  }
]