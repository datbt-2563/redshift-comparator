[
  {
    "no": "1",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_1",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "10"
  },
  {
    "no": "2",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_2",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "7"
  },
  {
    "no": "3",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_3",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "3"
  },
  {
    "no": "4",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_4",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "3"
  },
  {
    "no": "5",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_5",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "3"
  },
  {
    "no": "6",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_6",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '070f003f-2451-4f33-9347-d5ea39834288' AND l.couponMasterId = '070f003f-2451-4f33-9347-d5ea39834288' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '070f003f-2451-4f33-9347-d5ea39834288' AND l.couponMasterId = '070f003f-2451-4f33-9347-d5ea39834288' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "2"
  },
  {
    "no": "7",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_7",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '09bab7cd-c8c0-49e8-90d9-8b67046f1c8d' AND l.couponMasterId = '09bab7cd-c8c0-49e8-90d9-8b67046f1c8d' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '09bab7cd-c8c0-49e8-90d9-8b67046f1c8d' AND l.couponMasterId = '09bab7cd-c8c0-49e8-90d9-8b67046f1c8d' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "2"
  },
  {
    "no": "8",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_8",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "2"
  },
  {
    "no": "9",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_9",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "2"
  },
  {
    "no": "10",
    "queryPattern": "Q1",
    "queryName": "Display Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLog-function",
    "sourceCodeFunctionName": "displayedLogSql",
    "queryAlias": "Q1_10",
    "fullSQL": "SELECT l.couponId AS \"クーポンID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", l.operateFrom AS \"操作元\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponId = l.couponId) AS \"参照回数\", l.couponMasterId AS \"クーポンマスタID\" FROM coupon_logs l JOIN ( SELECT couponId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs WHERE type = 'displayed' GROUP BY couponId ) latest ON l.couponId = latest.couponId AND l.createAtMillis = latest.createAtMillis JOIN organization o ON l.organizationId = o.resourceId AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' ORDER BY l.couponCode, l.couponName, l.createAtMillis LIMIT 100 OFFSET 0 ",
    "count": "2"
  },
  {
    "no": "11",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_1",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/2c516452-2fd3-431b-a76b-1e2f8001fe54/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "9"
  },
  {
    "no": "12",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_2",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/a26078eb-91cb-4ce2-9223-0456dc1c83d0/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' AND l.couponMasterId = 'dd64917a-0420-416b-8908-5743ca434627' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "7"
  },
  {
    "no": "13",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_3",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4fab0e00-449b-4952-a6f0-4284dfcb93ad/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' AND l.couponMasterId = '38a405c5-bdff-4aaa-8189-aaca9b05d1e4' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "3"
  },
  {
    "no": "14",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_4",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/2a11722a-1c38-47bf-a373-4c3219e0010e/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' AND l.couponMasterId = '8c29f80a-0031-40ba-9506-6dad8a8527c7' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "3"
  },
  {
    "no": "15",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_5",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7924b134-3b7b-4748-8f28-3f622f92a988/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' AND l.couponMasterId = 'cbb980b6-fb05-4010-8376-941502ef2c06' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "3"
  },
  {
    "no": "16",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_6",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = 'fe3a5178-5406-4cc7-b331-b5c876448954' AND l.couponMasterId = 'fe3a5178-5406-4cc7-b331-b5c876448954' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/5f8fc2ef-d096-4411-a467-0465652d8f76/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fe3a5178-5406-4cc7-b331-b5c876448954' AND l.couponMasterId = 'fe3a5178-5406-4cc7-b331-b5c876448954' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "3"
  },
  {
    "no": "17",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_7",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/3eea8fb9-4f66-473c-98fa-a43b0dedb892/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' AND l.couponMasterId = '0c31274e-aff1-45c5-a484-813689f9fbb9' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "18",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_8",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '21ad38e3-7cfe-475c-9dcc-f60e0fccd183' AND l.couponMasterId = '21ad38e3-7cfe-475c-9dcc-f60e0fccd183' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/d047cea4-146c-4b28-afa6-b6b1bc68b9ae/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '21ad38e3-7cfe-475c-9dcc-f60e0fccd183' AND l.couponMasterId = '21ad38e3-7cfe-475c-9dcc-f60e0fccd183' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "19",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_9",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6b3135e4-c4b7-4f7c-894a-85c9f8d73e17/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' AND l.couponMasterId = '3155024d-3274-48df-aecd-dcfec3269553' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "20",
    "queryPattern": "Q2",
    "queryName": "Display Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponDisplayLogCsvUrl-function",
    "sourceCodeFunctionName": "displayedLogCsvSql",
    "queryAlias": "Q2_10",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.barcode AS \"バーコード\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI:SS') AS \"参照日時\", l.userAgent AS \"エージェント\" FROM coupon_logs l JOIN organization o ON l.organizationId = o.resourceId WHERE l.type = 'displayed' AND l.couponMasterId = '3c8acca2-c979-437b-bf60-a08af860888e' AND l.couponMasterId = '3c8acca2-c979-437b-bf60-a08af860888e' ORDER BY l.couponCode, l.couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/e259cfba-90b9-44a2-9409-dcb9479e35f7/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '3c8acca2-c979-437b-bf60-a08af860888e' AND l.couponMasterId = '3c8acca2-c979-437b-bf60-a08af860888e' ORDER BY l.couponCode, l.couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "21",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_1",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "42"
  },
  {
    "no": "22",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_2",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "41"
  },
  {
    "no": "23",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_3",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "39"
  },
  {
    "no": "24",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_4",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND l.couponCode LIKE '%tokyo-sento%' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND l.couponCode LIKE '%tokyo-sento%' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "35"
  },
  {
    "no": "25",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_5",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fcb6da48-238c-48d9-99a2-2b20ae643c8b' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "23"
  },
  {
    "no": "26",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_6",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND l.couponCode LIKE '%tokyo-sento%' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 100 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'fb00bd8f-867e-4fdb-a6f7-f531a116075f' AND l.couponCode LIKE '%tokyo-sento%' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 100 ",
    "count": "19"
  },
  {
    "no": "27",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_7",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'd048c138-0751-4829-b786-89d8ce34df2f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'd048c138-0751-4829-b786-89d8ce34df2f' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'd048c138-0751-4829-b786-89d8ce34df2f' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'd048c138-0751-4829-b786-89d8ce34df2f' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "15"
  },
  {
    "no": "28",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_8",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "14"
  },
  {
    "no": "29",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_9",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '4bb8c2f8-5ef7-461d-97ea-312bd1761de5' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "13"
  },
  {
    "no": "30",
    "queryPattern": "Q3",
    "queryName": "Usage Log Json",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLog-function",
    "sourceCodeFunctionName": "usageLogSql",
    "queryAlias": "Q3_10",
    "fullSQL": "SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second', 'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"') AS \"日時\", o2.name AS \"利用店舗\", l.customerShopCode AS \"店舗コード\", l.memberShopCode AS \"加盟店コード\", l.terminalNumber AS \"端末コード\", l.operateFrom AS \"操作元\", l.couponMasterId AS \"クーポンマスタID\", l.userId AS \"ユーザーID\", l.userName AS \"ユーザー名\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name LIMIT 100 OFFSET 0 ",
    "count": "12"
  },
  {
    "no": "31",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_1",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/1cd94941-dc0f-4f7b-8c7f-24654c6cabd0/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'da7b9138-b61b-4623-a016-9e6c381f6faf' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "47"
  },
  {
    "no": "32",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_2",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/de36ec23-4497-474c-adb3-bec08cc03dd3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '5006d7ac-57de-4ffb-a313-68a1ea20df85' ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "33"
  },
  {
    "no": "33",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_3",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '49e9303c-8c96-427c-8507-b5e064a8b7b9' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '49e9303c-8c96-427c-8507-b5e064a8b7b9' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/bc0abe59-a7bc-4805-8237-3c845d29b1c3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '49e9303c-8c96-427c-8507-b5e064a8b7b9' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '49e9303c-8c96-427c-8507-b5e064a8b7b9' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "15"
  },
  {
    "no": "34",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_4",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/db385fa0-454c-4ece-a0b0-e5dee5526c41/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '2f4973e6-47a0-4de8-9573-8188b5ddbe1e' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "14"
  },
  {
    "no": "35",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_5",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'df52ea33-9e3a-46d2-b53e-779b39db95d6' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'df52ea33-9e3a-46d2-b53e-779b39db95d6' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/693dc3ab-2cac-4af8-a6fa-293811a96656/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'df52ea33-9e3a-46d2-b53e-779b39db95d6' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'df52ea33-9e3a-46d2-b53e-779b39db95d6' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "14"
  },
  {
    "no": "36",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_6",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/8d80a9a1-8417-4b90-a983-686397bba70f/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '0e0803b2-faeb-41cf-9d6a-a67c6a3ee381' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "12"
  },
  {
    "no": "37",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_7",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '993443f0-2b9c-4b9c-aea6-0242046e3bbf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '993443f0-2b9c-4b9c-aea6-0242046e3bbf' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/2d983532-71b3-4c26-90f4-e9e66d55cf8f/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '993443f0-2b9c-4b9c-aea6-0242046e3bbf' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '993443f0-2b9c-4b9c-aea6-0242046e3bbf' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "12"
  },
  {
    "no": "38",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_8",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = 'a1c3e920-aaf2-4d93-9e0b-bc1d71aebe47' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'a1c3e920-aaf2-4d93-9e0b-bc1d71aebe47' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/fa74cc2b-b8ca-4bc2-ad31-5c8ec00ea398/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = 'a1c3e920-aaf2-4d93-9e0b-bc1d71aebe47' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = 'a1c3e920-aaf2-4d93-9e0b-bc1d71aebe47' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "12"
  },
  {
    "no": "39",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_9",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '1bfbea8c-f10d-456a-b940-e6088137b4da' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '1bfbea8c-f10d-456a-b940-e6088137b4da' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/cfba65e6-04b5-411f-b16a-5f851f58f135/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '1bfbea8c-f10d-456a-b940-e6088137b4da' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '1bfbea8c-f10d-456a-b940-e6088137b4da' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "11"
  },
  {
    "no": "40",
    "queryPattern": "Q4",
    "queryName": "Usage Log Csv",
    "lambdaFunctionName": "prd-coupon-InvokeCouponUsageLogCsvUrl-function",
    "sourceCodeFunctionName": "usageLogCsvSql",
    "queryAlias": "Q4_10",
    "fullSQL": "unload ($$ SELECT l.couponId AS \"クーポン交換ID\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", l.url AS \"消し込みURL\", l.barcode AS \"バーコード番号\", l.barcodeType AS \"バーコードタイプ\", CASE l.type WHEN 'issued' THEN '発行済み' WHEN 'used' THEN '使用済み' ELSE 'キャンセル' END AS \"ステータス\", to_char(DATEADD(hour, 9, TIMESTAMP 'epoch' + (l.createAtMillis / 1000) * INTERVAL '1 second'), 'YYYY/MM/DD\" \"HH24:MI') AS \"日時\", o2.name AS \"利用店舗\", l.terminalNumber AS \"端末コード\", o2.customershopcode AS \"顧客店舗コード\" FROM coupon_logs l JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN organization o2 ON o2.resourceId = l.usedShopId WHERE l.type <> 'displayed' AND l.couponMasterId = '3255875a-d2a4-4215-9ca4-212ccc428269' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '3255875a-d2a4-4215-9ca4-212ccc428269' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/aab07bd0-f96b-4d80-85fc-fd84ace3aaee/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ AND l.couponMasterId = '3255875a-d2a4-4215-9ca4-212ccc428269' AND NOT EXISTS ( SELECT 1 FROM coupon_logs AS l2 WHERE l.couponId = l2.couponId AND l2.type <> 'displayed' AND l.createAtMillis < l2.createAtMillis ) AND l.couponMasterId = '3255875a-d2a4-4215-9ca4-212ccc428269' AND l.type IN ('','','used','') ORDER BY l.couponName, l.barcode, l.couponId, l.createAtMillis, l.type, o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "11"
  },
  {
    "no": "41",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_1",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponName LIKE '%2311%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponName LIKE '%2311%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "26"
  },
  {
    "no": "42",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_2",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "17"
  },
  {
    "no": "43",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_3",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "12"
  },
  {
    "no": "44",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_4",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0003%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0003%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "9"
  },
  {
    "no": "45",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_5",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "8"
  },
  {
    "no": "46",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_6",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%本番%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%本番%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "7"
  },
  {
    "no": "47",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_7",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "7"
  },
  {
    "no": "48",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_8",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponCode LIKE '%030034007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponCode LIKE '%030034007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "4"
  },
  {
    "no": "49",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_9",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "4"
  },
  {
    "no": "50",
    "queryPattern": "Q5",
    "queryName": "Display Aggregate Json",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q5_10",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponName LIKE '%2311%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponName LIKE '%2311%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100 ",
    "count": "3"
  },
  {
    "no": "51",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_1",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/1da70939-2558-442d-8f00-efbdc60ddda3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "42"
  },
  {
    "no": "52",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_2",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6093a4e6-9734-48ba-83c3-03bd7e43fb8a/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "10"
  },
  {
    "no": "53",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_3",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6bcece6e-3477-4858-84fb-cd02b3937a19/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "4"
  },
  {
    "no": "54",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_4",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/8168d505-bcff-43c0-b4a9-499963677f81/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "55",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_5",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%sento%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/f4e5fd67-bf68-4af5-84b8-06619d528094/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%sento%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "56",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_6",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%art-ishigakijima-samplecoupon1%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/ab460228-d916-4d74-baab-3518ca8ae4b2/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%art-ishigakijima-samplecoupon1%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "57",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_7",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.name LIKE '%SBギフト%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/0adcde8f-9dd6-4c06-bae3-6faab886bc59/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.name LIKE '%SBギフト%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "58",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_8",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponName LIKE '%KC1094%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/b799caa9-60df-4baf-b761-31c97d18ab52/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponName LIKE '%KC1094%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "59",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_9",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9a2adfdd-81a7-4d04-ba5d-6a019f55c3dd/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "60",
    "queryPattern": "Q6",
    "queryName": "Display Aggregate Csv",
    "lambdaFunctionName": "prd-coupon-invokeCouponDisplayAggregateCsvUrl-function",
    "sourceCodeFunctionName": "displayedCsvSql",
    "queryAlias": "Q6_10",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId) AS \"参照数\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4a181ca0-7437-4381-9382-d3432d236a57/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "61",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_1",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "242"
  },
  {
    "no": "62",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_2",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "91"
  },
  {
    "no": "63",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_3",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "90"
  },
  {
    "no": "64",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_4",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "59"
  },
  {
    "no": "65",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_5",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%200%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%200%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "52"
  },
  {
    "no": "66",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_6",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "51"
  },
  {
    "no": "67",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_7",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "28"
  },
  {
    "no": "68",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_8",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "26"
  },
  {
    "no": "69",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_9",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "22"
  },
  {
    "no": "70",
    "queryPattern": "Q7",
    "queryName": "Usage Aggregate Json byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byCouponMasterSql",
    "queryAlias": "Q7_10",
    "fullSQL": "SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\", (SELECT COUNT(*) FROM coupon_logs l2 WHERE l2.type = 'displayed' AND l2.couponMasterId = l.couponMasterId)  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND l.couponCode LIKE '%kobe%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND l.couponCode LIKE '%kobe%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "21"
  },
  {
    "no": "71",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_1",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "14"
  },
  {
    "no": "72",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_2",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "5"
  },
  {
    "no": "73",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_3",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "5"
  },
  {
    "no": "74",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_4",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "5"
  },
  {
    "no": "75",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_5",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "5"
  },
  {
    "no": "76",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_6",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100 ",
    "count": "4"
  },
  {
    "no": "77",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_7",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '84f4ee9e-3f00-4530-adaf-9bd2dc15108b' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '84f4ee9e-3f00-4530-adaf-9bd2dc15108b' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "4"
  },
  {
    "no": "78",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_8",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "4"
  },
  {
    "no": "79",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_9",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100 ",
    "count": "3"
  },
  {
    "no": "80",
    "queryPattern": "Q8",
    "queryName": "Usage Aggregate Json byOrganizationSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateJson-function",
    "sourceCodeFunctionName": "byOrganizationSql",
    "queryAlias": "Q8_10",
    "fullSQL": "SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"自拠点発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l JOIN organization_closure oc ON oc.parentId = o.resourceId AND l.organizationId = oc.childId WHERE l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'used' ) AS \"自店舗消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE oc.parentId = 'd2f8c6ac-ebde-41c7-a0d8-ca34dfa397db' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "shortSQL": " _SAME_ WHERE oc.parentId = 'd2f8c6ac-ebde-41c7-a0d8-ca34dfa397db' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0 ",
    "count": "3"
  },
  {
    "no": "81",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_1",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/19c33f25-f622-4c6f-81a0-58ca51b517ae/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "49"
  },
  {
    "no": "82",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_2",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/71a4fd80-711a-4df1-8887-a271dbdd2927/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "46"
  },
  {
    "no": "83",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_3",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/14967b59-0df9-45d8-b8ff-2a0ba73c8f60/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "37"
  },
  {
    "no": "84",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_4",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6e7a9534-a97a-41aa-a12b-1d2e8593112c/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "18"
  },
  {
    "no": "85",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_5",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/f7377481-2b85-4d59-a2d5-cbb016c13af7/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "16"
  },
  {
    "no": "86",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_6",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/599a6189-f78e-472f-9803-8f2643893e74/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "10"
  },
  {
    "no": "87",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_7",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%200%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/87a53d28-5d15-4249-a10a-c8d94677140f/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%200%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "7"
  },
  {
    "no": "88",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_8",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%帰ってきた%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/ed94cca0-fdc2-420c-a718-b0e1822b979f/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%帰ってきた%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "6"
  },
  {
    "no": "89",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_9",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/b9360d97-f2eb-4ae6-b951-4ebcec8da360/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "6"
  },
  {
    "no": "90",
    "queryPattern": "Q9",
    "queryName": "Usage Aggregate Csv byCouponMasterSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byCouponMasterCsvSql",
    "queryAlias": "Q9_10",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", couponCode AS \"クーポンコード\", couponName AS \"クーポン名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'issued' AND l2.couponMasterId = l.couponMasterId ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'used' AND l2.couponMasterId = l.couponMasterId ) AS \"使用済数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l2 WHERE l2.type = 'canceled' AND l2.couponMasterId = l.couponMasterId ) AS \"キャンセル\"  FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%jichi%' ORDER BY couponCode, couponName $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/3fec7427-a9b2-4e3e-9d7b-12516ccac8ed/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ FROM coupon_logs l JOIN ( SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis, MAX(logUUID) AS logUUID FROM coupon_logs GROUP BY couponMasterId ) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis AND l.logUUID = latest.logUUID JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%jichi%' ORDER BY couponCode, couponName $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "5"
  },
  {
    "no": "91",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_1",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/11fb5920-dd80-4c01-b000-95b34e588989/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "7"
  },
  {
    "no": "92",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_2",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9123ee7f-42af-42b3-906e-1ea0ceec0988/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "6"
  },
  {
    "no": "93",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_3",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'BIG_SHOP_GROUP' AND oc.parentId = 'dcdaf32b-1480-4f98-9816-f35b349d6310' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/989f87a7-d635-4ccf-a76d-8c2886f8c7c2/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'BIG_SHOP_GROUP' AND oc.parentId = 'dcdaf32b-1480-4f98-9816-f35b349d6310' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "94",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_4",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/626d4f4a-9c6e-4a5e-9ecc-af548ec2b6c3/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "2"
  },
  {
    "no": "95",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_5",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/72fa5163-d5a2-4886-b5b2-41c0a4f2996f/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "96",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_6",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7a5aab76-3331-44c1-806a-ce544da6875d/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "97",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_7",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'd4e3ccff-215e-4bf3-b85b-d120b1e75278' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/bb709c96-3939-4cdc-aeb4-50e16efa1f67/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'd4e3ccff-215e-4bf3-b85b-d120b1e75278' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "98",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_8",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.name LIKE '%上野マルイ%' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/c08a0652-4a34-4126-a5c6-46d27de5f660/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.name LIKE '%上野マルイ%' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "99",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_9",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/23cc76a5-1c04-4ed2-8c8f-145e64b5aaa8/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  },
  {
    "no": "100",
    "queryPattern": "Q10",
    "queryName": "Usage Aggregate Csv byOrganizationCsvSql",
    "lambdaFunctionName": "prd-coupon-invokeCouponUsageAggregateCsvUrl-function",
    "sourceCodeFunctionName": "byOrganizationCsvSql",
    "queryAlias": "Q10_10",
    "fullSQL": "unload ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", ( SELECT COUNT(*) FROM coupon_logs_filtered l WHERE l.organizationId = o.resourceId AND l.type = 'issued' ) AS \"発行数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'used' ) AS \"消込数\", ( SELECT COUNT(*) FROM coupon_logs_filtered l, organization_closure oc WHERE oc.parentId = o.resourceId AND oc.childId = l.usedShopId AND l.type = 'canceled' ) AS \"キャンセル\"  FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY o.name $$) to 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4daa5fae-e23e-4a2e-ac2f-67e04b1948ba/' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "shortSQL": " _SAME_ WHERE o.type = 'SHOP' AND oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY o.name $$) to '_S3_PATH_' iam_role 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ",
    "count": "1"
  }
]
