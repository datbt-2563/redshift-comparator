5_1,WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"表示数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;"
5_2,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_3,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_4,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0003%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_5,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_6,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%本番%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_7,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_8,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponCode LIKE '%030034007%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_9,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
5_10,WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"表示数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponName LIKE '%2311%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 100;"
6_1,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/1da70939-2558-442d-8f00-efbdc60ddda3/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ALLOWOVERWRITE;
"
6_2,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6093a4e6-9734-48ba-83c3-03bd7e43fb8a/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_3,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/6bcece6e-3477-4858-84fb-cd02b3937a19/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_4,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/8168d505-bcff-43c0-b4a9-499963677f81/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_5,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%sento%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/f4e5fd67-bf68-4
"
6_6,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%art-ishigakijima-samplecoupon1%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/ab460228-d916-4d74-baab-3518ca8ae4b2/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_7,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.name LIKE '%SBギフト%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/0adcde8f-9dd6-4c06-bae3-6faab886bc59/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_8,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '153d75fa-61f1-4ea0-bd73-33ad14b99c87' AND l.couponName LIKE '%KC1094%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/b799caa9-60df-4baf-b761-31c97d18ab52/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_9,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9a2adfdd-81a7-4d04-ba5d-6a019f55c3dd/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF;
"
6_10,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4a181ca0-7437-4381-9382-d3432d236a57/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' HEADER DELIMITER ',' ADDQUOTES PARALLEL OFF ALLOWOVERWRITE;"
7_1,WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"表示数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_2,WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_3,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_4,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_5,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMa
"
7_6,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_7,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND l.couponCode LIKE '%0001%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_8,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_9,WITH issued_count AS (SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId) ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId) uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;
"
7_10,WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), displayed_count AS (SELECT couponMasterId, COUNT(*) AS displayed_count FROM coupon_logs WHERE type = 'displayed' GROUP BY couponMasterId) SELECT l.couponMasterId, o.resourceId, o.name, l.couponCode, l.couponName, COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(dc.displayed_count, 0) AS \"参照数\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId LEFT JOIN displayed_count dc ON dc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND l.couponCode LIKE '%kobe%' ORDER BY l.couponCode, l.couponName, l.createAtMillis, o.resourceId LIMIT 100 OFFSET 0;"
8_1,WITH issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"自拠点発行数\", COALESCE(uc.used_count, 0) AS \"自店舗消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\", COALESCE(usc.usedShop_count, 0) AS \"消込数\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT l.organizationId, COUNT(*) AS issued_count FROM coupon_logs l WHERE l.type = 'issued' GROUP BY l.organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT l.organizationId, COUNT(*) AS used_count FROM coupon_logs l WHERE l.type = 'used' GROUP BY l.organizationId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT l.organizationId, COUNT(*) AS canceled_count FROM coupon_logs l WHERE l.type = 'canceled' GROUP BY l.organizationId) cc ON cc.organizationId = o.resourceId LEFT JOIN (SELECT l.usedShopId, COUNT(*) AS usedShop_count FROM coupon_logs l WHERE l.type = 'used' GROUP BY l.usedShopId) usc ON usc.usedShopId = o.resourceId WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_2,WITH issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_3,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_4,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_5,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_6,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100;
"
8_7,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '84f4ee9e-3f00-4530-adaf-9bd2dc15108b' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_8,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
8_9,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 100;
"
8_10,WITH local_issued_count AS (SELECT o.resourceId AS \"組織ID\", o.name AS \"組織名\", COALESCE(li.local_issued_count, 0) AS \"自拠点発行数\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(lu.local_used_count, 0) AS \"自店舗消込数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) li ON li.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS issued_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.organizationId WHERE type = 'issued' GROUP BY oc.parentId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS local_used_count FROM coupon_logs WHERE type = 'used' GROUP BY organizationId) lu ON lu.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE oc.parentId = 'd2f8c6ac-ebde-41c7-a0d8-ca34dfa397db' AND o.type = 'SHOP' ORDER BY o.name, o.resourceId LIMIT 100 OFFSET 0;
"
9_1,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), latest_logs AS (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN latest_logs ll ON l.couponMasterId = ll.couponMasterId AND l.createAtMillis = ll.createAtMillis LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponCode LIKE '%tokyo-sento%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/19c33f25-f622-4c6f-81a0-58ca51b517ae/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_2,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId), latest_logs AS (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN latest_logs ll ON l.couponMasterId = ll.couponMasterId AND l.createAtMillis = ll.createAtMillis LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/71a4fd80-711a-4df1-8887-a271dbdd2927/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_3,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId WHERE oc.parentId = '8219ca6d-38a1-447f-a59a-6b9cdee52985' AND l.couponCode LIKE '%ichibanya%' ORDER BY l.couponCode, l.couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/14967b59-0df9-45d8-b8ff-2a0ba73c8f60/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
9_4,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY l.couponCode, l.couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'd634f7c1-f232-4abc-b4dc-5a7c8dbbca6e' ORDER BY l.couponCode, l.couponName $$) TO 's3://your-s3-bucket-path/' IAM_ROLE 'arn:aws:iam::856562439801:role/your-redshift-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
9_5,UNLOAD ($$ WITH latest_logs AS (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId), issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN latest_logs ll ON l.couponMasterId = ll.couponMasterId AND l.createAtMillis = ll.createAtMillis LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '1673ced4-18f3-449a-a621-160b3f678499' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/f7377481-2b85-4d59-a2d5-cbb016c13af7/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_6,UNLOAD ($$ WITH latest_logs AS (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId), issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN latest_logs ll ON l.couponMasterId = ll.couponMasterId AND l.createAtMillis = ll.createAtMillis LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '6b8a558d-bf01-4d1a-87d8-2e7a62ae85e0' AND l.couponCode LIKE '%ACLE1105%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/599a6189-f78e-472f-9803-8f2643893e74/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_7,UNLOAD ($$ WITH latest_logs AS (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId), issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN latest_logs ll ON l.couponMasterId = ll.couponMasterId AND l.createAtMillis = ll.createAtMillis LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId WHERE oc.parentId = '228575b5-1bc6-4eaa-917b-10fc52a11fb9' AND l.couponName LIKE '%200%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/87a53d28-5d15-4249-a10a-c8d94677140f/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_8,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e32094fb-c933-4c35-b1db-b03faa2e2d7a' AND l.couponName LIKE '%帰ってきた%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/ed94cca0-fdc2-420c-a718-b0e1822b979f/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;
"
9_9,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId WHERE oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/b9360d97-f2eb-4ae6-b951-4ebcec8da360/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;"
9_10,UNLOAD ($$ WITH issued_count AS (SELECT couponMasterId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY couponMasterId), used_count AS (SELECT couponMasterId, COUNT(*) AS used_count FROM coupon_logs WHERE type = 'used' GROUP BY couponMasterId), canceled_count AS (SELECT couponMasterId, COUNT(*) AS canceled_count FROM coupon_logs WHERE type = 'canceled' GROUP BY couponMasterId) SELECT ROW_NUMBER() OVER(ORDER BY couponCode, couponName) AS \"No\", o.name AS \"組織名\", l.couponCode AS \"クーポンコード\", l.couponName AS \"クーポン名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"使用済数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM coupon_logs l JOIN (SELECT couponMasterId, MAX(createAtMillis) AS createAtMillis FROM coupon_logs GROUP BY couponMasterId) latest ON l.couponMasterId = latest.couponMasterId AND l.createAtMillis = latest.createAtMillis JOIN organization_closure oc ON oc.childId = l.organizationId JOIN organization o ON o.resourceId = l.organizationId LEFT JOIN issued_count ic ON ic.couponMasterId = l.couponMasterId LEFT JOIN used_count uc ON uc.couponMasterId = l.couponMasterId LEFT JOIN canceled_count cc ON cc.couponMasterId = l.couponMasterId WHERE oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' AND l.couponCode LIKE '%jichi%' ORDER BY couponCode, couponName $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/3fec7427-a9b2-4e3e-9d7b-12516ccac8ed/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF ALLOWOVERWRITE;"
10_1,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '7b012f01-1362-4f92-8cbd-83bdb69ccd28' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/11fb5920-dd80-4c01-b000-95b34e588989/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_2,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '966b73e3-c8b2-4305-a1bc-24de6bb4748f' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/9123ee7f-42af-42b3-906e-1ea0ceec0988/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_3,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'BIG_SHOP_GROUP' AND oc.parentId = 'dcdaf32b-1480-4f98-9816-f35b349d6310' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/989f87a7-d635-4ccf-a76d-8c2886f8c7c2/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_4,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '2d604e05-5c13-423f-ae98-7f29dc5cc1cf' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/626d4f4a-9c6e-4a5e-9ecc-af548ec2b6c3/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;"
10_5,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = '0a30b1f7-eabb-48f3-b70c-d10264da9e2a' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/72fa5163-d5a2-4886-b5b2-41c0a4f2996f/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_6,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'a998e975-6bfd-40f3-8a64-4e489a6b7cc5' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/7a5aab76-3331-44c1-806a-ce544da6875d/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_7,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'd4e3ccff-215e-4bf3-b85b-d120b1e75278' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/bb709c96-3939-4cdc-aeb4-50e16efa1f67/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_8,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'e40b822d-2c9d-4060-9a4a-e9c82cb9da98' AND o.name LIKE '%上野マルイ%' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/c08a0652-4a34-4126-a5c6-46d27de5f660/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_9,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'e99ecb04-e950-4cd3-a384-0fbaeeabd227' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/23cc76a5-1c04-4ed2-8c8f-145e64b5aaa8/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
10_10,UNLOAD ($$ SELECT ROW_NUMBER() OVER(ORDER BY o.name) AS \"No\", o.name AS \"組織名\", COALESCE(ic.issued_count, 0) AS \"発行数\", COALESCE(uc.used_count, 0) AS \"消込数\", COALESCE(cc.canceled_count, 0) AS \"キャンセル\" FROM organization o JOIN organization_closure oc ON oc.childId = o.resourceId LEFT JOIN (SELECT organizationId, COUNT(*) AS issued_count FROM coupon_logs WHERE type = 'issued' GROUP BY organizationId) ic ON ic.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS used_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'used' GROUP BY oc.parentId) uc ON uc.organizationId = o.resourceId LEFT JOIN (SELECT oc.parentId AS organizationId, COUNT(*) AS canceled_count FROM coupon_logs l JOIN organization_closure oc ON oc.childId = l.usedShopId WHERE type = 'canceled' GROUP BY oc.parentId) cc ON cc.organizationId = o.resourceId WHERE o.type = 'SHOP' AND oc.parentId = 'f0e001ee-52da-42fa-8929-8227d3947a74' ORDER BY o.name $$) TO 's3://prd-coupon-redshift-bucket-ap-northeast-1-856562439801/4daa5fae-e23e-4a2e-ac2f-67e04b1948ba/' IAM_ROLE 'arn:aws:iam::856562439801:role/coupon-redshift-cluster-role' DELIMITER ',' ADDQUOTES HEADER PARALLEL OFF;
"
